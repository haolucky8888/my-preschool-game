<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹¼å¸ˆæŠ€èƒ½è§£é”å¤§é—¯å…³</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Comic Sans MS', 'æ¥·ä½“', sans-serif;
            background-color: #FFFAF5;
            background-image: url('https://img.freepik.com/free-vector/gradient-pastel-sky-background_23-2148917404.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            width: 95%;
            max-width: 1000px;
            height: auto;
            min-height: 85vh;
            margin: 15px auto;
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            box-shadow: 0 0 25px rgba(255, 182, 193, 0.6);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            border: 4px solid #FFD1DC;
        }

        /* ç¬¬ä¸€å…³æ¸¸æˆåŒºåŸŸé…è‰² */
        #level1 .question {
            background-color: #FFF5F5;
            border-color: #FFB6C1;
        }
        #level1 .option {
            background: linear-gradient(45deg, #FFB6C1, #FF8E9E);
        }
        #level1 .option:hover {
            background: linear-gradient(45deg, #FF8E9E, #FF6B8B);
        }

        /* ç¬¬äºŒå…³æ¸¸æˆåŒºåŸŸé…è‰² */
        #level2 .question {
            background-color: #F5F9FF;
            border-color: #A5D8FF;
        }
        #level2 .option {
            background: linear-gradient(45deg, #A5D8FF, #74CAFF);
        }
        #level2 .option:hover {
            background: linear-gradient(45deg, #74CAFF, #3DB4FF);
        }

        /* ç¬¬ä¸‰å…³æ¸¸æˆåŒºåŸŸé…è‰² */
        #level3 .question {
            background-color: #F5FFF5;
            border-color: #C1E3C1;
        }
        #level3 .option {
            background: linear-gradient(45deg, #C1E3C1, #9BD69B);
        }
        #level3 .option:hover {
            background: linear-gradient(45deg, #9BD69B, #74C174);
        }
        #level3 .situation {
            background-color: #FFF9E6;
            border-left: 5px solid #FFD166;
            margin-bottom: 10px;
        }
        
        .game-content {
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            display: flex;
            flex-direction: column;
        }
        
        .start-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100%;
            text-align: center;
            padding: 30px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 20px;
        }
        
        .welcome-title {
            font-size: 3.5em;
            color: #FF6B8B;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            background: linear-gradient(to right, #FF6B8B, #FF8E53, #FFD166);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: rainbow 3s ease infinite;
            font-weight: 900;
            padding: 15px 30px;
            border-radius: 60px;
            box-shadow: 0 8px 20px rgba(255, 107, 139, 0.3);
            line-height: 1.2;
        }
        
        @keyframes rainbow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        .welcome-subtitle {
            font-size: 2em;
            color: #FF8E53;
            margin-bottom: 30px;
            line-height: 1.3;
            padding: 0 20px;
            font-weight: bold;
        }
        
        .welcome-text {
            font-size: 1.6em;
            color: #FF6B8B;
            margin-bottom: 40px;
            line-height: 1.4;
            font-weight: bold;
        }
        
        .start-btn {
            background: linear-gradient(45deg, #FF6B8B, #FF8E53, #FFD166);
            color: white;
            border: none;
            border-radius: 60px;
            padding: 18px 45px;
            font-size: 2em;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 30px;
            box-shadow: 0 12px 20px rgba(255, 107, 139, 0.5);
            font-weight: bold;
            position: relative;
            overflow: hidden;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            border: 4px solid white;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .start-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 15px 25px rgba(255, 107, 139, 0.6);
            animation: none;
        }
        
        .level {
            display: none;
            flex: 1;
            overflow-y: auto;
            padding: 10px;
            flex-direction: column;
        }
        
        .level.active {
            display: flex;
        }
        
        .level-title {
            color: #FF6B8B;
            text-align: center;
            font-size: 2em;
            margin-bottom: 15px;
            background: linear-gradient(to right, #FF6B8B, #FF8E53);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            padding: 10px 0;
        }
        
        .level-target {
            color: #FF8E53;
            text-align: left;
            font-size: 1.4em;
            margin-bottom: 15px;
            font-weight: bold;
            padding: 0 10px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .progress-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding: 0 10px;
        }
        
        .timer {
            font-size: 1.4em;
            color: #FF6B8B;
            font-weight: bold;
        }
        
        .progress-info {
            font-size: 1.4em;
            color: #FF6B8B;
            font-weight: bold;
        }
        
        .progress-steps {
            display: flex;
        }
        
        .progress-step {
            width: 38px;
            height: 38px;
            border-radius: 50%;
            background-color: #FFD1DC;
            margin: 0 6px;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #FFF;
            font-weight: bold;
            font-size: 1.1em;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
            border: 2px solid white;
        }
        
        .progress-step.active {
            background: linear-gradient(45deg, #FF6B8B, #FF8E53);
            transform: scale(1.1);
        }
        
        .progress-step.completed {
            background: linear-gradient(45deg, #74CAFF, #3DB4FF);
            transform: scale(1.1);
        }
        
        .question {
            background-color: white;
            border-radius: 20px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 8px 15px rgba(255, 182, 193, 0.4);
            border: 3px solid #FFD1DC;
            flex: 1;
            display: flex;
            flex-direction: column;
            min-height: auto;
        }
        
        .question-text {
            font-size: 1.4em;
            margin-bottom: 12px;
            color: #555;
            font-weight: bold;
            line-height: 1.4;
        }
        
        .options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }
        
        .option {
            color: white;
            border: none;
            border-radius: 15px;
            padding: 12px;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: bold;
            min-height: 70px;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            word-break: break-word;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            border: 3px solid white;
        }
        
        .option:hover {
            transform: scale(1.03);
        }
        
        .feedback {
            display: none;
            text-align: center;
            margin-top: 12px;
            padding: 15px;
            border-radius: 15px;
            font-size: 1.4em;
            line-height: 1.4;
            max-height: 280px;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .feedback.correct {
            background-color: #C8FACD;
            color: #006400;
            border: 3px solid #5CDB5C;
        }
        
        .feedback.incorrect {
            background-color: #FFD6D6;
            color: #7f0000;
            border: 3px solid #FF8E8E;
        }
        
        .confetti {
            position: fixed;
            width: 15px;
            height: 15px;
            background-color: #f00;
            animation: fall 5s linear infinite;
            z-index: 1000;
            border-radius: 50%;
            pointer-events: none;
            box-shadow: 0 0 8px rgba(0,0,0,0.5);
        }
        
        @keyframes fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }
        
        .completion-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1001;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
            text-align: center;
        }
        
        .completion-content {
            background-color: white;
            padding: 35px;
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 80%;
            position: relative;
            z-index: 1002;
        }
        
        .completion-message {
            font-size: 3em;
            margin-bottom: 25px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            animation: blink 0.8s infinite alternate, bounce 1s infinite;
            font-weight: bold;
            line-height: 1.2;
            color: #FF6B8B;
        }
        
        @keyframes blink {
            from { opacity: 1; text-shadow: 0 0 10px #FFF, 0 0 20px #FFF; }
            to { opacity: 0.9; text-shadow: 0 0 5px #FFF, 0 0 10px #FFF; }
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-12px); }
        }
        
        .medal {
            width: 160px;
            height: 160px;
            margin-bottom: 18px;
            animation: spin 2s infinite ease-in-out, flash 1.5s infinite;
            filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.8));
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(12deg) scale(1.15); }
            100% { transform: rotate(0deg) scale(1); }
        }
        
        @keyframes flash {
            0%, 100% { filter: drop-shadow(0 0 15px rgba(255, 215, 0, 0.8)); }
            50% { filter: drop-shadow(0 0 25px rgba(255, 215, 0, 1)); }
        }
        
        .medal-text {
            font-size: 2em;
            color: #FF6B8B;
            margin-bottom: 18px;
            font-weight: bold;
            animation: pulse 1.5s infinite alternate;
        }
        
        @keyframes pulse {
            from { transform: scale(1); }
            to { transform: scale(1.05); }
        }
        
        .next-level-btn {
            background: linear-gradient(45deg, #FF6B8B, #FF8E53);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 14px 35px;
            font-size: 1.6em;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 18px;
            box-shadow: 0 8px 20px rgba(255, 107, 139, 0.5);
            font-weight: bold;
            position: relative;
            overflow: hidden;
            z-index: 1;
            border: 3px solid white;
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
        }
        
        .next-level-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 25px rgba(255, 107, 139, 0.6);
        }
        
        .total-time {
            text-align: center;
            font-size: 1.8em;
            color: #FF6B8B;
            margin-top: 18px;
            font-weight: bold;
        }
        
        .verb-display {
            font-size: 2em;
            color: #FF6B8B;
            text-align: center;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .situation {
            background-color: #FFF9E6;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 10px;
            border-left: 5px solid #FFD166;
            box-shadow: 0 6px 15px rgba(255, 209, 102, 0.3);
            display: flex;
            align-items: center;
        }
        
        .situation-text {
            font-style: italic;
            color: #FF8E53;
            font-size: 1.4em;
            line-height: 1.4;
            flex: 1;
        }
        
        .audio-icon {
            width: 40px;
            height: 40px;
            cursor: pointer;
            margin-left: 12px;
            transition: all 0.3s;
            filter: drop-shadow(0 0 8px rgba(255, 107, 139, 0.4));
        }
        
        .audio-icon:hover {
            transform: scale(1.1);
            filter: drop-shadow(0 0 12px rgba(255, 107, 139, 0.6));
        }
        
        .explanation {
            font-size: 1.2em;
            margin-top: 12px;
            line-height: 1.4;
            color: #555;
            background-color: #F8F9FA;
            padding: 12px;
            border-radius: 12px;
            border-left: 4px solid #74CAFF;
        }

        @media (max-width: 768px) {
            .container {
                width: 98%;
                padding: 15px;
                min-height: 95vh;
            }
            
            .options {
                grid-template-columns: 1fr;
            }
            
            .welcome-title {
                font-size: 2.5em;
                padding: 10px 20px;
            }
            
            .welcome-subtitle {
                font-size: 1.6em;
            }
            
            .welcome-text {
                font-size: 1.4em;
            }
            
            .start-btn {
                font-size: 1.6em;
                padding: 12px 35px;
            }
            
            .level-title {
                font-size: 1.7em;
            }
            
            .question-text {
                font-size: 1.2em;
            }
            
            .option {
                font-size: 1.1em;
                padding: 12px;
                min-height: 65px;
            }
            
            .completion-message {
                font-size: 2.2em;
            }
            
            .medal {
                width: 140px;
                height: 140px;
            }
            
            .medal-text {
                font-size: 1.7em;
            }
            
            .next-level-btn {
                font-size: 1.4em;
                padding: 12px 30px;
            }
            
            .progress-step {
                width: 34px;
                height: 34px;
                font-size: 1em;
                margin: 0 4px;
            }
            
            .progress-container {
                flex-direction: column;
                align-items: stretch;
            }
            
            .timer, .progress-info {
                margin-bottom: 8px;
                text-align: center;
            }
            
            .situation {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .audio-icon {
                margin-left: 0;
                margin-top: 10px;
                align-self: center;
            }
            
            .level-target {
                white-space: normal;
                text-overflow: clip;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- å¼€å§‹å±å¹• -->
        <div class="start-screen" id="startScreen">
            <h1 class="welcome-title">å¹¼å¸ˆæŠ€èƒ½è§£é”å¤§é—¯å…³</h1>
            <p class="welcome-subtitle">ğŸ¯æŒ‘æˆ˜ä¸‰å…³ï¼Œè§£é”å¹¼å¸ˆå¿…å¤‡æŠ€èƒ½ï¼</p>
            <p class="welcome-text">ğŸš€å‡†å¤‡å¥½æˆä¸ºæœªæ¥çš„å¹¼å¸ˆä¹‹æ˜Ÿäº†å—ï¼Ÿ</p>
            <button class="start-btn" onclick="startGame()">å¼€å§‹é—¯å…³</button>
        </div>
        
        <!-- æ¸¸æˆä¸»ç•Œé¢ -->
        <div id="gameContainer" style="display: none;">
            <div class="progress-container">
                <div class="timer" id="timer">æ—¶é—´: 00:00</div>
                <div class="progress-info" id="progressInfo"></div>
                <div class="progress-steps">
                    <div class="progress-step" id="step1">1</div>
                    <div class="progress-step" id="step2">2</div>
                    <div class="progress-step" id="step3">3</div>
                </div>
            </div>
            
            <div class="game-content">
                <!-- ç¬¬ä¸€å…³ -->
                <div class="level" id="level1">
                    <h2 class="level-title">ç¬¬ä¸€å…³ï¼šåŸºç¡€å…³-åŠ¨è¯å˜å½¢å°ä¸“å®¶</h2>
                    <p class="level-target">ç›®æ ‡ï¼šç†Ÿç»ƒæŒæ¡å­¦å‰æ•™è‚²èŒä¸šæƒ…å¢ƒå¸¸ç”¨åŠ¨è¯çš„è¿‡å»åˆ†è¯å½¢å¼ï¼ˆè§„åˆ™ä¸ä¸è§„åˆ™ï¼‰</p>
                    <div class="question">
                        <p class="verb-display" id="currentVerb"></p>
                        <div class="question-text">è¯·é€‰æ‹©æ­£ç¡®çš„è¿‡å»åˆ†è¯å½¢å¼ï¼š</div>
                        <div class="options" id="options1"></div>
                    </div>
                    <div class="feedback" id="feedback1"></div>
                </div>
                
                <!-- ç¬¬äºŒå…³ -->
                <div class="level" id="level2">
                    <h2 class="level-title">ç¬¬äºŒå…³ï¼šè¿›é˜¶å…³-æ—¶æ€è¾¨åˆ«å°èƒ½æ‰‹</h2>
                    <p class="level-target">ç›®æ ‡ï¼šå‡†ç¡®è¯†åˆ«ç°åœ¨å®Œæˆæ—¶çš„ç»“æ„ (have/has + è¿‡å»åˆ†è¯)ï¼Œå¹¶èƒ½åŒºåˆ†å…¶ä»–æ—¶æ€</p>
                    <div class="question" id="question2">
                        <div class="question-text" id="question-text2"></div>
                        <div class="options" id="options2"></div>
                    </div>
                    <div class="feedback" id="feedback2"></div>
                </div>
                
                <!-- ç¬¬ä¸‰å…³ -->
                <div class="level" id="level3">
                    <h2 class="level-title">ç¬¬ä¸‰å…³ï¼šé«˜éš¾å…³-æƒ…å¢ƒåº”ç”¨å°è¾¾äºº</h2>
                    <p class="level-target">ç›®æ ‡ï¼šåœ¨æ¨¡æ‹Ÿçš„å­¦å‰æ•™è‚²èŒä¸šæƒ…å¢ƒä¸­ï¼Œç»¼åˆè¿ç”¨ç°åœ¨å®Œæˆæ—¶è¿›è¡Œæ²Ÿé€šã€æè¿°æˆ–è§£å†³é—®é¢˜</p>
                    <div class="situation" id="situation3">
                        <img src="https://cdn-icons-png.flaticon.com/512/3621/3621550.png" class="audio-icon" alt="æ’­æ”¾éŸ³é¢‘" onclick="playSituationAudio()">
                        <div class="situation-text" id="situation-text3"></div>
                    </div>
                    <div class="question">
                        <div class="question-text">è¯·é€‰æ‹©æœ€åˆé€‚çš„é€‰é¡¹ï¼š</div>
                        <div class="options" id="options3"></div>
                    </div>
                    <div class="feedback" id="feedback3"></div>
                </div>
            </div>
        </div>
        
        <!-- é€šå…³å±å¹• -->
        <div class="completion-screen" id="completion1">
            <div class="completion-content">
                <h1 class="completion-message" style="color: #FF6B8B; background: linear-gradient(to right, #FF6B8B, #FF8E53, #FFD166); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">æ­å–œä½ æˆä¸ºåŠ¨è¯å˜å½¢å°ä¸“å®¶ï¼</h1>
                <img src="https://cdn-icons-png.flaticon.com/512/3132/3132739.png" class="medal" alt="å¹¼æ•™åŸºæœ¬åŠŸå‹‹ç« ">
                <p class="medal-text">è·å¾—å‹‹ç« ï¼šå¹¼æ•™åŸºæœ¬åŠŸå‹‹ç« </p>
                <button class="next-level-btn" onclick="nextLevel(2)">è¿›å…¥ç¬¬äºŒå…³</button>
            </div>
        </div>
        
        <div class="completion-screen" id="completion2">
            <div class="completion-content">
                <h1 class="completion-message" style="color: #FF8E53; background: linear-gradient(to right, #FF8E53, #FF6B8B, #FFD166); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">æ­å–œä½ æˆä¸ºæ—¶æ€è¾¨åˆ«å°èƒ½æ‰‹ï¼</h1>
                <img src="https://cdn-icons-png.flaticon.com/512/3132/3132735.png" class="medal" alt="è¯¾å ‚è§‚å¯Ÿå®¶å‹‹ç« ">
                <p class="medal-text">è·å¾—å‹‹ç« ï¼šè¯¾å ‚è§‚å¯Ÿå®¶å‹‹ç« </p>
                <button class="next-level-btn" onclick="nextLevel(3)">è¿›å…¥ç¬¬ä¸‰å…³</button>
            </div>
        </div>
        
        <div class="completion-screen" id="completion3">
            <div class="completion-content">
                <h1 class="completion-message" style="color: #FFD166; background: linear-gradient(to right, #FFD166, #FF8E53, #FF6B8B); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">æ­å–œä½ æˆä¸ºæƒ…å¢ƒåº”ç”¨å°è¾¾äººï¼</h1>
                <img src="https://cdn-icons-png.flaticon.com/512/3132/3132773.png" class="medal" alt="æœªæ¥å¹¼å¸ˆä¹‹æ˜Ÿå‹‹ç« ">
                <p class="medal-text">è·å¾—å‹‹ç« ï¼šæœªæ¥å¹¼å¸ˆä¹‹æ˜Ÿå‹‹ç« </p>
                <div class="total-time" id="totalTime"></div>
                <button class="next-level-btn" onclick="restartGame()">å†ç©ä¸€æ¬¡</button>
            </div>
        </div>
    </div>
    
    <audio id="correctSound" src="https://www.soundjay.com/buttons/sounds/button-09.mp3"></audio>
    <audio id="wrongSound" src="https://www.soundjay.com/buttons/sounds/button-10.mp3"></audio>
    <audio id="amazingSound" src="https://www.soundjay.com/buttons/sounds/button-21.mp3"></audio>
    <audio id="situationAudio"></audio>
    
    <script>
        // æ¸¸æˆæ•°æ®
        const gameData = {
            level1: {
                verbs: [
                    { 
                        base: "design", 
                        correct: "designed", 
                        incorrects: ["designs", "designing", "design"],
                        explanation: "è§„åˆ™åŠ¨è¯ï¼Œç›´æ¥åœ¨è¯å°¾åŠ -edã€‚design â†’ designed"
                    },
                    { 
                        base: "play", 
                        correct: "played", 
                        incorrects: ["plays", "playing", "play"],
                        explanation: "è§„åˆ™åŠ¨è¯ï¼Œä»¥å…ƒéŸ³å­—æ¯+yç»“å°¾ï¼Œç›´æ¥åŠ -edã€‚play â†’ played"
                    },
                    { 
                        base: "improve", 
                        correct: "improved", 
                        incorrects: ["improves", "improving", "improve"],
                        explanation: "è§„åˆ™åŠ¨è¯ï¼Œä»¥eç»“å°¾ï¼Œç›´æ¥åŠ -dã€‚improve â†’ improved"
                    },
                    { 
                        base: "study", 
                        correct: "studied", 
                        incorrects: ["studys", "studying", "study"],
                        explanation: "è§„åˆ™åŠ¨è¯ï¼Œä»¥è¾…éŸ³å­—æ¯+yç»“å°¾ï¼Œå˜yä¸ºiå†åŠ -edã€‚study â†’ studied"
                    },
                    { 
                        base: "plan", 
                        correct: "planned", 
                        incorrects: ["plans", "planning", "plan"],
                        explanation: "è§„åˆ™åŠ¨è¯ï¼Œé‡è¯»é—­éŸ³èŠ‚ä¸”æœ«å°¾åªæœ‰ä¸€ä¸ªè¾…éŸ³å­—æ¯ï¼ŒåŒå†™æœ«å°¾è¾…éŸ³å­—æ¯å†åŠ -edã€‚plan â†’ planned"
                    },
                    { 
                        base: "draw", 
                        correct: "drawn", 
                        incorrects: ["drawed", "drawing", "draws"],
                        explanation: "ä¸è§„åˆ™åŠ¨è¯ï¼Œdraw â†’ drew â†’ drawnã€‚è¿‡å»åˆ†è¯æ˜¯drawn"
                    },
                    { 
                        base: "teach", 
                        correct: "taught", 
                        incorrects: ["teached", "teaching", "teaches"],
                        explanation: "ä¸è§„åˆ™åŠ¨è¯ï¼Œteach â†’ taught â†’ taughtã€‚è¿‡å»åˆ†è¯æ˜¯taught"
                    },
                    { 
                        base: "read", 
                        correct: "read", 
                        incorrects: ["readed", "reading", "reads"],
                        explanation: "ä¸è§„åˆ™åŠ¨è¯ï¼Œread â†’ read â†’ readã€‚æ³¨æ„å‘éŸ³å˜åŒ–ï¼Œè¿‡å»åˆ†è¯æ‹¼å†™ä¸å˜"
                    },
                    { 
                        base: "speak", 
                        correct: "spoken", 
                        incorrects: ["speaked", "speaking", "speaks"],
                        explanation: "ä¸è§„åˆ™åŠ¨è¯ï¼Œspeak â†’ spoke â†’ spokenã€‚è¿‡å»åˆ†è¯æ˜¯spoken"
                    },
                    { 
                        base: "write", 
                        correct: "written", 
                        incorrects: ["writed", "writing", "writes"],
                        explanation: "ä¸è§„åˆ™åŠ¨è¯ï¼Œwrite â†’ wrote â†’ writtenã€‚è¿‡å»åˆ†è¯æ˜¯written"
                    }
                ],
                currentIndex: 0,
                wrongAnswers: []
            },
            
            level2: {
                questions: [
                    {
                        text: "1. Two days ago, the preschool held an interesting parent-child sports meeting. The tense of the sentence is ______.",
                        options: ["ä¸€èˆ¬ç°åœ¨æ—¶", "ä¸€èˆ¬è¿‡å»æ—¶", "ç°åœ¨å®Œæˆæ—¶", "ä¸€èˆ¬å°†æ¥æ—¶"],
                        correct: 1,
                        explanation: "æ­£ç¡®ç­”æ¡ˆæ˜¯B. ä¸€èˆ¬è¿‡å»æ—¶ã€‚å¥å­ä¸­æœ‰æ˜ç¡®è¡¨ç¤ºè¿‡å»çš„æ—¶é—´çŠ¶è¯­'two days ago'ï¼Œä¸”åŠ¨è¯'held'æ˜¯holdçš„è¿‡å»å¼ã€‚"
                    },
                    {
                        text: "2. Mr. Zhang has worked in this kindergarten for five years. The tense of the sentence is ______.",
                        options: ["ä¸€èˆ¬ç°åœ¨æ—¶", "ä¸€èˆ¬è¿‡å»æ—¶", "ç°åœ¨å®Œæˆæ—¶", "ä¸€èˆ¬å°†æ¥æ—¶"],
                        correct: 2,
                        explanation: "æ­£ç¡®ç­”æ¡ˆæ˜¯C. ç°åœ¨å®Œæˆæ—¶ã€‚å¥å­ç»“æ„ä¸º'has + è¿‡å»åˆ†è¯(worked)'ï¼Œè¡¨ç¤ºä»è¿‡å»æŒç»­åˆ°ç°åœ¨çš„åŠ¨ä½œã€‚"
                    },
                    {
                        text: "3. Look! The children ______ their hands before snack time.",
                        options: ["wash", "washed", "have washed", "are washing"],
                        correct: 2,
                        explanation: "æ­£ç¡®ç­”æ¡ˆæ˜¯C. have washedã€‚'before snack time'è¡¨ç¤ºåœ¨åƒç‚¹å¿ƒå‰å·²ç»å®Œæˆçš„åŠ¨ä½œï¼Œç”¨ç°åœ¨å®Œæˆæ—¶å¼ºè°ƒç»“æœã€‚"
                    },
                    {
                        text: "4. The preschool teacher _________the children how to share and take turns since the beginning of the term. It's an important social skill.",
                        options: ["has taught", "taught", "teach", "will teach"],
                        correct: 0,
                        explanation: "æ­£ç¡®ç­”æ¡ˆæ˜¯A. has taughtã€‚'since the beginning of the term'è¡¨ç¤ºä»è¿‡å»æŒç»­åˆ°ç°åœ¨çš„åŠ¨ä½œï¼Œç”¨ç°åœ¨å®Œæˆæ—¶ã€‚"
                    },
                    {
                        text: "5. ______ a STEM project for preschoolers? We need examples.",
                        options: ["Do you plan", "Did you plan", "Have you ever planned", "Are you planning"],
                        correct: 2,
                        explanation: "æ­£ç¡®ç­”æ¡ˆæ˜¯C. Have you ever plannedã€‚è¯¢é—®è¿‡å»çš„ç»éªŒå¯¹ç°åœ¨çš„å½±å“ï¼Œç”¨ç°åœ¨å®Œæˆæ—¶ã€‚"
                    }
                ],
                currentIndex: 0,
                wrongAnswers: []
            },
            
            level3: {
                situations: [
                    {
                        text: "æƒ…å¢ƒ1ï¼šä½ åœ¨å¡«å†™å¹¼å„¿æˆé•¿æ¡£æ¡ˆçš„'è¿‘æœŸè¿›æ­¥'æ æ—¶ï¼Œæè¿°ä¸€ä¸ªå­©å­'å·²ç»å­¦ä¼šè‡ªå·±ç©¿å¤–å¥—'ã€‚åˆ¤æ–­å“ªä¸ªè¡¨è¿°æ›´åˆé€‚ã€‚",
                        audio: "https://www.soundjay.com/buttons/sounds/button-01.mp3",
                        options: [
                            "He puts on his coat by himself.",
                            "He put on his coat by himself yesterday.",
                            "He has learned to put on his coat by himself.",
                            "He will put on his coat by himself."
                        ],
                        correct: 2,
                        explanation: "æ­£ç¡®ç­”æ¡ˆæ˜¯C. ç°åœ¨å®Œæˆæ—¶has learnedè¡¨ç¤ºå·²ç»å­¦ä¼šå¹¶ä¸”ç°åœ¨ä¼šè‡ªå·±ç©¿å¤–å¥—ï¼Œå¼ºè°ƒç°åœ¨çš„çŠ¶æ€ã€‚"
                    },
                    {
                        text: "æƒ…å¢ƒ2ï¼šå‡†å¤‡æˆ·å¤–æ´»åŠ¨å‰ï¼Œä½ éœ€è¦ç¡®è®¤å®‰å…¨ã€‚é—®ä¿è‚²å‘˜ï¼š'ä½ æ£€æŸ¥è¿‡æ”€çˆ¬æ¶äº†å—ï¼Ÿ' é€‰æ‹©æœ€ç¬¦åˆæ­¤æƒ…å¢ƒçš„é—®æ³•ã€‚",
                        audio: "https://www.soundjay.com/buttons/sounds/button-02.mp3",
                        options: [
                            "Do you check the climbing frame?",
                            "Did you check the climbing frame?",
                            "Have you checked the climbing frame?",
                            "Are you checking the climbing frame?"
                        ],
                        correct: 2,
                        explanation: "æ­£ç¡®ç­”æ¡ˆæ˜¯C. Have you checked...? ç°åœ¨å®Œæˆæ—¶è¯¢é—®æ˜¯å¦å·²ç»å®Œæˆæ£€æŸ¥ï¼Œå¼ºè°ƒå¯¹ç°åœ¨çš„å½±å“ï¼ˆæ˜¯å¦å®‰å…¨ï¼‰ã€‚"
                    },
                    {
                        text: "æƒ…å¢ƒ3ï¼šåˆé¤æ—¶ï¼Œä¸€ä¸ªå­©å­çªç„¶å‘•åã€‚ä½ å¤„ç†å®Œç°åœºå¹¶å®‰æŠšå¥½å­©å­åï¼Œéœ€è¦å‘ä¸»ç­è€å¸ˆæ±‡æŠ¥ã€‚ä»¥ä¸‹å“ªå¥è¯æœ€åˆé€‚ï¼Ÿ",
                        audio: "https://www.soundjay.com/buttons/sounds/button-03.mp3",
                        options: [
                            "I clean the floor.",
                            "I cleaned the floor.",
                            "I have cleaned the floor and comforted the child.",
                            "I will clean the floor."
                        ],
                        correct: 2,
                        explanation: "æ­£ç¡®ç­”æ¡ˆæ˜¯C. ç°åœ¨å®Œæˆæ—¶è¡¨ç¤ºå·²ç»å®Œæˆå¤„ç†ï¼Œå¼ºè°ƒç°åœ¨çš„ç»“æœï¼ˆå·²ç»å¹²å‡€ï¼Œå­©å­å·²å®‰æŠšï¼‰ã€‚"
                    },
                    {
                        text: "æƒ…å¢ƒ4ï¼šä¸€ä½å®¶é•¿ä¸‹åˆæ¥æ¥å­©å­ï¼Œé—®é“ï¼š'æˆ‘çš„å®å®ä»Šå¤©åƒé¥­æ€ä¹ˆæ ·ï¼Ÿ' ä½ æƒ³å‘Šè¯‰å®¶é•¿å­©å­åˆé¥­åƒå¾—å¾ˆå¥½ï¼Œå¹¶ä¸”æ°´æœç‚¹å¿ƒä¹Ÿåƒå®Œäº†ã€‚",
                        audio: "https://www.soundjay.com/buttons/sounds/button-04.mp3",
                        options: [
                            "He ate well.",
                            "He ate well at lunch, and he has finished all his fruit snack.",
                            "He is eating his fruit snack.",
                            "He eats well every day."
                        ],
                        correct: 1,
                        explanation: "æ­£ç¡®ç­”æ¡ˆæ˜¯B. å‰åŠéƒ¨åˆ†ç”¨ä¸€èˆ¬è¿‡å»æ—¶æè¿°åˆé¤æƒ…å†µï¼ŒååŠéƒ¨åˆ†ç”¨ç°åœ¨å®Œæˆæ—¶è¡¨ç¤ºå·²ç»åƒå®Œæ°´æœç‚¹å¿ƒï¼ˆå¼ºè°ƒç°åœ¨çš„ç»“æœï¼‰ã€‚"
                    },
                    {
                        text: "æƒ…å¢ƒ5ï¼šä¸€ä¸ªå­©å­è·‘è¿‡æ¥å‘ŠçŠ¶ï¼š'è€å¸ˆï¼Œä¹ä¹æ¨æˆ‘äº†ï¼' ä½ æƒ³äº†è§£ä¹ä¹æ˜¯å¦å·²ç»é“æ­‰ã€‚ä½ åº”è¯¥é—®ä¹ä¹ï¼š",
                        audio: "https://www.soundjay.com/buttons/sounds/button-05.mp3",
                        options: [
                            "Do you push him?",
                            "Did you push him?",
                            "Have you said sorry to him?",
                            "Will you say sorry?"
                        ],
                        correct: 2,
                        explanation: "æ­£ç¡®ç­”æ¡ˆæ˜¯C. Have you said sorry...? ç°åœ¨å®Œæˆæ—¶è¯¢é—®æ˜¯å¦å·²ç»å®Œæˆé“æ­‰ï¼ˆå¼ºè°ƒç°åœ¨æ˜¯å¦å·²ç»é“æ­‰ï¼‰ã€‚"
                    }
                ],
                currentIndex: 0,
                wrongAnswers: []
            }
        };
        
        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            currentLevel: 1,
            startTime: null,
            levelStartTime: null,
            levelTimes: [0, 0, 0],
            completedLevels: 0,
            gameStarted: false
        };
        
        // DOMå…ƒç´ 
        const elements = {
            startScreen: document.getElementById('startScreen'),
            gameContainer: document.getElementById('gameContainer'),
            gameContent: document.querySelector('.game-content'),
            timer: document.getElementById('timer'),
            progressInfo: document.getElementById('progressInfo'),
            currentVerb: document.getElementById('currentVerb'),
            options1: document.getElementById('options1'),
            feedback1: document.getElementById('feedback1'),
            questionText2: document.getElementById('question-text2'),
            options2: document.getElementById('options2'),
            feedback2: document.getElementById('feedback2'),
            situationText3: document.getElementById('situation-text3'),
            options3: document.getElementById('options3'),
            feedback3: document.getElementById('feedback3'),
            completion1: document.getElementById('completion1'),
            completion2: document.getElementById('completion2'),
            completion3: document.getElementById('completion3'),
            totalTime: document.getElementById('totalTime'),
            step1: document.getElementById('step1'),
            step2: document.getElementById('step2'),
            step3: document.getElementById('step3'),
            correctSound: document.getElementById('correctSound'),
            wrongSound: document.getElementById('wrongSound'),
            amazingSound: document.getElementById('amazingSound'),
            situationAudio: document.getElementById('situationAudio')
        };
        
        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            elements.startScreen.style.display = 'none';
            elements.gameContainer.style.display = 'flex';
            elements.gameContainer.style.flexDirection = 'column';
            gameState.gameStarted = true;
            gameState.startTime = new Date();
            gameState.levelStartTime = new Date();
            startTimer();
            loadLevel(1);
        }
        
        // é‡æ–°å¼€å§‹æ¸¸æˆ
        function restartGame() {
            // é‡ç½®æ¸¸æˆæ•°æ®
            gameData.level1.currentIndex = 0;
            gameData.level1.wrongAnswers = [];
            gameData.level2.currentIndex = 0;
            gameData.level2.wrongAnswers = [];
            gameData.level3.currentIndex = 0;
            gameData.level3.wrongAnswers = [];
            
            // é‡ç½®æ¸¸æˆçŠ¶æ€
            gameState = {
                currentLevel: 1,
                startTime: null,
                levelStartTime: null,
                levelTimes: [0, 0, 0],
                completedLevels: 0,
                gameStarted: false
            };
            
            // éšè—æ‰€æœ‰é€šå…³ç”»é¢å’Œæ¸¸æˆç•Œé¢
            document.querySelectorAll('.completion-screen').forEach(el => el.style.display = 'none');
            elements.gameContainer.style.display = 'none';
            
            // æ˜¾ç¤ºå¼€å§‹å±å¹•
            elements.startScreen.style.display = 'flex';
        }
        
        // è®¡æ—¶å™¨
        let timerInterval;
        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                if (gameState.gameStarted) {
                    const now = new Date();
                    const elapsed = new Date(now - gameState.startTime);
                    const minutes = elapsed.getMinutes().toString().padStart(2, '0');
                    const seconds = elapsed.getSeconds().toString().padStart(2, '0');
                    elements.timer.textContent = `æ—¶é—´: ${minutes}:${seconds}`;
                }
            }, 1000);
        }
        
        // åŠ è½½å…³å¡
        function loadLevel(level) {
            // éšè—æ‰€æœ‰å…³å¡
            document.querySelectorAll('.level').forEach(el => el.classList.remove('active'));
            
            // æ›´æ–°è¿›åº¦æ¡
            document.querySelectorAll('.progress-step').forEach((el, index) => {
                el.classList.remove('active', 'completed');
                if (index + 1 === level) el.classList.add('active');
                if (index + 1 < level) el.classList.add('completed');
            });
            
            gameState.currentLevel = level;
            gameState.levelStartTime = new Date();
            
            if (level === 1) {
                loadLevel1();
            } else if (level === 2) {
                loadLevel2();
            } else if (level === 3) {
                loadLevel3();
            }
            
            document.getElementById(`level${level}`).classList.add('active');
            elements.gameContent.scrollTo(0, 0);
        }
        
        // åŠ è½½ç¬¬ä¸€å…³
        function loadLevel1() {
            const levelData = gameData.level1;
            
            // æ›´æ–°è¿›åº¦ä¿¡æ¯
            updateProgressInfo(1);
            
            // æ£€æŸ¥æ˜¯å¦æœ‰ç­”é”™çš„é¢˜ç›®éœ€è¦é‡æ–°å›ç­”
            if (levelData.wrongAnswers.length > 0) {
                const wrongVerb = levelData.wrongAnswers[0];
                const verb = levelData.verbs.find(v => v.base === wrongVerb);
                
                elements.currentVerb.textContent = verb.base;
                
                const options = [verb.correct, ...verb.incorrects];
                shuffleArray(options);
                
                elements.options1.innerHTML = '';
                options.forEach((option, index) => {
                    const button = document.createElement('button');
                    button.className = 'option';
                    button.textContent = option;
                    button.onclick = () => checkAnswer1(option === verb.correct, verb, option);
                    elements.options1.appendChild(button);
                });
                return;
            }
            
            // æ­£å¸¸åŠ è½½æ–°é¢˜ç›®
            if (levelData.currentIndex < levelData.verbs.length) {
                const verb = levelData.verbs[levelData.currentIndex];
                elements.currentVerb.textContent = verb.base;
                
                // åˆ›å»ºé€‰é¡¹ï¼ˆæ­£ç¡®ç­”æ¡ˆ+3ä¸ªé”™è¯¯ç­”æ¡ˆï¼‰
                const options = [verb.correct, ...verb.incorrects];
                shuffleArray(options);
                
                elements.options1.innerHTML = '';
                options.forEach((option, index) => {
                    const button = document.createElement('button');
                    button.className = 'option';
                    button.textContent = option;
                    button.onclick = () => checkAnswer1(option === verb.correct, verb, option);
                    elements.options1.appendChild(button);
                });
            } else {
                // æ‰€æœ‰é¢˜ç›®ç­”å¯¹ï¼Œé€šå…³
                completeLevel(1);
            }
        }
        
        // æ›´æ–°è¿›åº¦ä¿¡æ¯
        function updateProgressInfo(level) {
            const levelData = gameData[`level${level}`];
            let current, total;
            
            if (level === 1) {
                current = levelData.currentIndex + 1 - levelData.wrongAnswers.length;
                total = levelData.verbs.length;
            } else if (level === 2) {
                current = levelData.currentIndex + 1 - levelData.wrongAnswers.length;
                total = levelData.questions.length;
            } else if (level === 3) {
                current = levelData.currentIndex + 1 - levelData.wrongAnswers.length;
                total = levelData.situations.length;
            }
            
            elements.progressInfo.textContent = `è¿›åº¦: ${current}/${total}`;
        }
        
        // æ£€æŸ¥ç¬¬ä¸€å…³ç­”æ¡ˆ
        function checkAnswer1(isCorrect, verb, selectedAnswer) {
            const levelData = gameData.level1;
            
            // ç¦ç”¨æ‰€æœ‰é€‰é¡¹æŒ‰é’®ï¼Œé˜²æ­¢é‡å¤ç‚¹å‡»
            const buttons = elements.options1.querySelectorAll('button');
            buttons.forEach(btn => btn.disabled = true);
            
            if (isCorrect) {
                elements.feedback1.className = 'feedback correct';
                elements.feedback1.innerHTML = `
                    <p>æ­£ç¡®ï¼${verb.base}çš„è¿‡å»åˆ†è¯æ˜¯${verb.correct}ã€‚</p>
                    <div class="explanation">${verb.explanation}</div>
                `;
                elements.correctSound.play();
                setTimeout(() => {
                    elements.amazingSound.play();
                }, 500);
                
                // å¦‚æœæ˜¯é‡æ–°å›ç­”çš„é”™è¯¯é¢˜ç›®ï¼Œä»é”™è¯¯åˆ—è¡¨ä¸­ç§»é™¤
                if (levelData.wrongAnswers.includes(verb.base)) {
                    levelData.wrongAnswers = levelData.wrongAnswers.filter(v => v !== verb.base);
                } else {
                    // å¦åˆ™æ˜¯æ­£å¸¸é¢˜ç›®ï¼Œå¢åŠ ç´¢å¼•
                    levelData.currentIndex++;
                }
            } else {
                elements.feedback1.className = 'feedback incorrect';
                elements.feedback1.innerHTML = `
                    <p>ä¸å¯¹å“¦ï¼ä½ é€‰æ‹©äº†${selectedAnswer}ï¼Œä½†${verb.base}çš„è¿‡å»åˆ†è¯æ˜¯${verb.correct}ã€‚</p>
                    <div class="explanation">${verb.explanation}</div>
                `;
                elements.wrongSound.play();
                
                // æ·»åŠ åˆ°é”™è¯¯åˆ—è¡¨ï¼Œå¦‚æœè¿˜æ²¡æœ‰çš„è¯
                if (!levelData.wrongAnswers.includes(verb.base)) {
                    levelData.wrongAnswers.push(verb.base);
                }
            }
            
            elements.feedback1.style.display = 'block';
            
            setTimeout(() => {
                elements.feedback1.style.display = 'none';
                loadLevel1();
            }, 3000);
        }
        
        // åŠ è½½ç¬¬äºŒå…³
        function loadLevel2() {
            const levelData = gameData.level2;
            
            // æ›´æ–°è¿›åº¦ä¿¡æ¯
            updateProgressInfo(2);
            
            // æ£€æŸ¥æ˜¯å¦æœ‰ç­”é”™çš„é¢˜ç›®éœ€è¦é‡æ–°å›ç­”
            if (levelData.wrongAnswers.length > 0) {
                const wrongIndex = levelData.wrongAnswers[0];
                const question = levelData.questions[wrongIndex];
                
                elements.questionText2.textContent = question.text;
                
                elements.options2.innerHTML = '';
                question.options.forEach((option, index) => {
                    const button = document.createElement('button');
                    button.className = 'option';
                    button.textContent = option;
                    button.onclick = () => checkAnswer2(index === question.correct, question, index, wrongIndex);
                    elements.options2.appendChild(button);
                });
                return;
            }
            
            // æ­£å¸¸åŠ è½½æ–°é¢˜ç›®
            if (levelData.currentIndex < levelData.questions.length) {
                const question = levelData.questions[levelData.currentIndex];
                elements.questionText2.textContent = question.text;
                
                elements.options2.innerHTML = '';
                question.options.forEach((option, index) => {
                    const button = document.createElement('button');
                    button.className = 'option';
                    button.textContent = option;
                    button.onclick = () => checkAnswer2(index === question.correct, question, index, levelData.currentIndex);
                    elements.options2.appendChild(button);
                });
            } else {
                // æ‰€æœ‰é¢˜ç›®ç­”å¯¹ï¼Œé€šå…³
                completeLevel(2);
            }
        }
        
        // æ£€æŸ¥ç¬¬äºŒå…³ç­”æ¡ˆ
        function checkAnswer2(isCorrect, question, selectedIndex, questionIndex) {
            const levelData = gameData.level2;
            
            // ç¦ç”¨æ‰€æœ‰é€‰é¡¹æŒ‰é’®ï¼Œé˜²æ­¢é‡å¤ç‚¹å‡»
            const buttons = elements.options2.querySelectorAll('button');
            buttons.forEach(btn => btn.disabled = true);
            
            if (isCorrect) {
                elements.feedback2.className = 'feedback correct';
                elements.feedback2.innerHTML = `
                    <p>æ­£ç¡®ï¼${question.explanation}</p>
                `;
                elements.correctSound.play();
                setTimeout(() => {
                    elements.amazingSound.play();
                }, 500);
                
                // å¦‚æœæ˜¯é‡æ–°å›ç­”çš„é”™è¯¯é¢˜ç›®ï¼Œä»é”™è¯¯åˆ—è¡¨ä¸­ç§»é™¤
                if (levelData.wrongAnswers.includes(questionIndex)) {
                    levelData.wrongAnswers = levelData.wrongAnswers.filter(i => i !== questionIndex);
                } else {
                    // å¦åˆ™æ˜¯æ­£å¸¸é¢˜ç›®ï¼Œå¢åŠ ç´¢å¼•
                    levelData.currentIndex++;
                }
            } else {
                elements.feedback2.className = 'feedback incorrect';
                elements.feedback2.innerHTML = `
                    <p>ä¸å¯¹å“¦ï¼ä½ é€‰æ‹©äº†${question.options[selectedIndex]}ï¼Œ${question.explanation}</p>
                `;
                elements.wrongSound.play();
                
                // æ·»åŠ åˆ°é”™è¯¯åˆ—è¡¨ï¼Œå¦‚æœè¿˜æ²¡æœ‰çš„è¯
                if (!levelData.wrongAnswers.includes(questionIndex)) {
                    levelData.wrongAnswers.push(questionIndex);
                }
            }
            
            elements.feedback2.style.display = 'block';
            
            setTimeout(() => {
                elements.feedback2.style.display = 'none';
                loadLevel2();
            }, 3000);
        }
        
        // åŠ è½½ç¬¬ä¸‰å…³
        function loadLevel3() {
            const levelData = gameData.level3;
            
            // æ›´æ–°è¿›åº¦ä¿¡æ¯
            updateProgressInfo(3);
            
            // æ£€æŸ¥æ˜¯å¦æœ‰ç­”é”™çš„é¢˜ç›®éœ€è¦é‡æ–°å›ç­”
            if (levelData.wrongAnswers.length > 0) {
                const wrongIndex = levelData.wrongAnswers[0];
                const situation = levelData.situations[wrongIndex];
                
                elements.situationText3.textContent = situation.text;
                elements.situationAudio.src = situation.audio;
                
                elements.options3.innerHTML = '';
                situation.options.forEach((option, index) => {
                    const button = document.createElement('button');
                    button.className = 'option';
                    button.textContent = option;
                    button.onclick = () => checkAnswer3(index === situation.correct, situation, index, wrongIndex);
                    elements.options3.appendChild(button);
                });
                return;
            }
            
            // æ­£å¸¸åŠ è½½æ–°é¢˜ç›®
            if (levelData.currentIndex < levelData.situations.length) {
                const situation = levelData.situations[levelData.currentIndex];
                elements.situationText3.textContent = situation.text;
                elements.situationAudio.src = situation.audio;
                
                elements.options3.innerHTML = '';
                situation.options.forEach((option, index) => {
                    const button = document.createElement('button');
                    button.className = 'option';
                    button.textContent = option;
                    button.onclick = () => checkAnswer3(index === situation.correct, situation, index, levelData.currentIndex);
                    elements.options3.appendChild(button);
                });
            } else {
                // æ‰€æœ‰é¢˜ç›®ç­”å¯¹ï¼Œé€šå…³
                completeLevel(3);
            }
        }
        
        // æ’­æ”¾æƒ…å¢ƒéŸ³é¢‘
        function playSituationAudio() {
            elements.situationAudio.play();
        }
        
        // æ£€æŸ¥ç¬¬ä¸‰å…³ç­”æ¡ˆ
        function checkAnswer3(isCorrect, situation, selectedIndex, questionIndex) {
            const levelData = gameData.level3;
            
            // ç¦ç”¨æ‰€æœ‰é€‰é¡¹æŒ‰é’®ï¼Œé˜²æ­¢é‡å¤ç‚¹å‡»
            const buttons = elements.options3.querySelectorAll('button');
            buttons.forEach(btn => btn.disabled = true);
            
            if (isCorrect) {
                elements.feedback3.className = 'feedback correct';
                elements.feedback3.innerHTML = `
                    <p>æ­£ç¡®ï¼${situation.explanation}</p>
                `;
                elements.correctSound.play();
                setTimeout(() => {
                    elements.amazingSound.play();
                }, 500);
                
                // å¦‚æœæ˜¯é‡æ–°å›ç­”çš„é”™è¯¯é¢˜ç›®ï¼Œä»é”™è¯¯åˆ—è¡¨ä¸­ç§»é™¤
                if (levelData.wrongAnswers.includes(questionIndex)) {
                    levelData.wrongAnswers = levelData.wrongAnswers.filter(i => i !== questionIndex);
                } else {
                    // å¦åˆ™æ˜¯æ­£å¸¸é¢˜ç›®ï¼Œå¢åŠ ç´¢å¼•
                    levelData.currentIndex++;
                }
            } else {
                elements.feedback3.className = 'feedback incorrect';
                elements.feedback3.innerHTML = `
                    <p>ä¸å¯¹å“¦ï¼${situation.explanation}</p>
                `;
                elements.wrongSound.play();
                
                // æ·»åŠ åˆ°é”™è¯¯åˆ—è¡¨ï¼Œå¦‚æœè¿˜æ²¡æœ‰çš„è¯
                if (!levelData.wrongAnswers.includes(questionIndex)) {
                    levelData.wrongAnswers.push(questionIndex);
                }
            }
            
            elements.feedback3.style.display = 'block';
            
            setTimeout(() => {
                elements.feedback3.style.display = 'none';
                loadLevel3();
            }, 3000);
        }
        
        // å®Œæˆå…³å¡
        function completeLevel(level) {
            // è®°å½•å…³å¡ç”¨æ—¶
            const now = new Date();
            gameState.levelTimes[level - 1] = Math.floor((now - gameState.levelStartTime) / 1000);
            gameState.completedLevels++;
            
            // æ˜¾ç¤ºé€šå…³ç”»é¢
            document.getElementById(`completion${level}`).style.display = 'flex';
            createConfetti();
            
            // å¦‚æœæ˜¯ç¬¬ä¸‰å…³ï¼Œè®¡ç®—æ€»ç”¨æ—¶
            if (level === 3) {
                const totalSeconds = gameState.levelTimes.reduce((a, b) => a + b, 0);
                const minutes = Math.floor(totalSeconds / 60);
                const seconds = totalSeconds % 60;
                elements.totalTime.textContent = `æ€»ç”¨æ—¶: ${minutes}åˆ†${seconds}ç§’`;
            }
        }
        
        // ä¸‹ä¸€å…³
        function nextLevel(level) {
            document.getElementById(`completion${level-1}`).style.display = 'none';
            loadLevel(level);
        }
        
        // åˆ›å»ºå½©å¸¦æ•ˆæœ
        function createConfetti() {
            const colors = ['#FF6B8B', '#FFD166', '#06D6A0', '#118AB2', '#EF476F', '#FFC43D', '#1B9AAA', '#FF9F1C'];
            
            // æ¸…é™¤ä¹‹å‰çš„å½©å¸¦
            document.querySelectorAll('.confetti').forEach(el => el.remove());
            
            for (let i = 0; i < 200; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.left = `${Math.random() * 100}vw`;
                confetti.style.animationDuration = `${3 + Math.random() * 4}s`;
                confetti.style.animationDelay = `${Math.random() * 2}s`;
                confetti.style.width = `${10 + Math.random() * 15}px`;
                confetti.style.height = `${10 + Math.random() * 15}px`;
                confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                confetti.style.opacity = 0.8;
                confetti.style.zIndex = '1001';
                document.body.appendChild(confetti);
                
                setTimeout(() => {
                    confetti.remove();
                }, 7000);
            }
        }
        
        // è¾…åŠ©å‡½æ•°ï¼šæ‰“ä¹±æ•°ç»„
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
    </script>
</body>
</html>